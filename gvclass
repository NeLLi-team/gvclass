#!/usr/bin/env python
"""Thin GVClass launcher that resolves repository path and delegates to src.bin.gvclass_cli."""

import os
import sys
from pathlib import Path


def resolve_repo_dir(script_path: Path) -> Path:
    """Resolve the GVClass repo directory when running from a copied script."""
    candidate = script_path.parent
    if (candidate / "src").exists():
        return candidate

    env_path = os.environ.get("GVCLASS_REPO")
    if env_path:
        env_repo = Path(env_path).expanduser().resolve()
        if (env_repo / "src").exists():
            return env_repo

    repo_path_file = Path.home() / ".config" / "gvclass" / "repo_path"
    if repo_path_file.exists():
        repo_path = repo_path_file.read_text().strip()
        if repo_path:
            file_repo = Path(repo_path).expanduser().resolve()
            if (file_repo / "src").exists():
                return file_repo

    cwd = Path.cwd().resolve()
    for parent in [cwd] + list(cwd.parents):
        if (parent / "src").exists() and (parent / "gvclass").exists():
            return parent

    return candidate


def main() -> int:
    script_path = Path(__file__).resolve()
    repo_dir = resolve_repo_dir(script_path)

    if str(repo_dir) not in sys.path:
        sys.path.insert(0, str(repo_dir))

    os.environ.setdefault("GVCLASS_REPO", str(repo_dir))

    from src.bin.gvclass_cli import main as cli_main

    return cli_main(repo_dir=repo_dir)


if __name__ == "__main__":
    raise SystemExit(main())
