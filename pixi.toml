[workspace]
name = "gvclass"
version = "1.2.2"
description = "Giant virus classification tool using phylogenetic analysis"
authors = ["fschulz@lbl.gov"]
channels = ["conda-forge", "bioconda"]
platforms = ["linux-64"]

[dependencies]
# Python runtime
python = "3.11.*"
# Core scientific libraries used in the code
pandas = "==2.3.3"        # Used for data manipulation
biopython = "==1.85"      # Used for sequence I/O

# Phylogenetic analysis
ete3 = "==3.1.2"          # Used for tree parsing and analysis
iqtree = "==3.0.1"        # External binary for tree building
diamond = "==2.1.23"      # Fast protein alignment

# Build dependencies for pyrodigal
cython = "3.0.*"
setuptools = "==81.0.0"
wheel = "==0.46.2"

# System utilities
pyyaml = "==6.0.2"        # For config file parsing
psutil = "==7.2.1"        # For system monitoring
scikit-learn = "==1.7.2"

[pypi-dependencies]
# Bioinformatics tools (Python implementations)
pyhmmer = "==0.12.0"          # HMM search
pytrimal = "==0.8.5"          # Alignment trimming
pyfamsa = "==0.6.2"           # Multiple sequence alignment
pyrodigal = { git = "https://github.com/tomasbruna/pyrodigal.git" }  # Gene calling with codes 106, 129
pyswrd = "==0.3.1"            # BLAST alternative
veryfasttree = "==4.0.4.1"    # FastTree implementation

# CLI framework
click = "==8.3.1"

[tasks]
# Main command
gvclass = "./gvclass"

# Run example data
run-example = "./gvclass example -o example_results --threads 8"

# Install CLI entrypoints to ~/bin
install-cli = "python -m src.bin.install_cli"

# Manual database setup (database is included in container)
setup-db = "python -m src.bin.setup_database"

# Performance monitoring utilities
monitor-performance = "python src/test/monitor_performance.py"

# Container building
build-containers = "bash containers/build.sh"
build-docker = "docker build -t gvclass:1.2.2 -f containers/docker/Dockerfile ."
build-apptainer = "apptainer build gvclass.sif docker-daemon://gvclass:1.2.2"
analyze-parallel = "python src/test/analyze_parallelization.py"

test = "python -m pytest"
format = "black src gvclass"
lint = "flake8 src"
type-check = "mypy src"

[feature.dev.dependencies]
# Development tools
pytest = "*"
black = "*"
flake8 = "*"
mypy = "*"
pre-commit = "*"
click = "==8.3.1"  # Force version in dev too

[environments]
default = ["dev"]

[tool.pixi.pypi-options]
allow-pre-releases = true
